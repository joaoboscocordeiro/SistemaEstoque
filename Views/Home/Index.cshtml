@model List<Produto>

@{
    ViewData["Title"] = "Dashboard";
    var termoBusca = ViewBag.TermoBusca as string;
}

<h2 class="mb-4">Dashboard</h2>

<!-- Cards -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
            <div class="card-body">
                <h5 class="card-title">Total de Produtos</h5>
                <p class="card-text fs-4">@ViewBag.TotalProdutos</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-danger mb-3">
            <div class="card-body">
                <h5 class="card-title">Estoque Baixo</h5>
                <p class="card-text fs-4">@ViewBag.TotalEstoqueBaixo</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">Valor Total em Estoque</h5>
                <p class="card-text fs-4">@ViewBag.ValorTotalEstoque.ToString("C")</p>
            </div>
        </div>
    </div>
</div>
<!-- Pesquisa rápida -->
<form method="get" class="mb-4">
    <div class="input-group">
        <input type="text" class="form-control" name="termoBusca" value="@termoBusca" id="autocompleteInput" placeholder="Buscar produto...">
        <button class="btn btn-outline-secondary" type="submit">
            <i class="bi bi-search"></i>
        </button>
    </div>
</form>
<!-- Tabela de produtos -->
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Preço</th>
            <th>Estoque</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var produto in Model)
        {
            <tr>
                <td>@produto.Nome</td>
                <td>@produto.Preco?.ToString("C")</td>
                <td>@produto.Quantidade</td>
            </tr>
        }
    </tbody>
</table>
<!-- Paginação -->
<nav>
    <ul class="pagination">
        @for (int i = 1; i <= (int)ViewBag.TotalPaginas; i++)
        {
            <li class="page-item @(i == ViewBag.PaginaAtual ? "active" : "")">
                <a class="page-link"
                   href="?page=@i&termoBusca=@termoBusca">@i</a>
            </li>
        }
    </ul>
</nav>
@section Scripts {
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
    <script>
        $(function () {
        var produtos = [
        @foreach (var p in Model)
        {
            @: "@p.Nome",
            // adiciona vírgula automaticamente
        }
        ];
        $("#autocompleteInput").autocomplete({
        source: produtos
        });
        });
    </script>
}
